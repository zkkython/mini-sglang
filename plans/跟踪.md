# Mini-SGLang 学习进度跟踪

## 基本信息
- 学习者：[你的名字]
- 开始日期：[YYYY-MM-DD]
- 预计总时长：100-140小时（8-10周）
- 每周投入：15-20小时

## 阶段一：入门与基础
| 任务 | 预计时长 | 实际开始 | 实际结束 | 状态 | 学习收获/笔记 |
|------|----------|----------|----------|------|---------------|
| 1.1 环境准备 | 2-3h | 2026-02-12 | 2026-02-12 | 🟢 已完成 | 虚拟环境创建成功，所有依赖安装完成，环境测试通过 |
| 1.2 初次运行 | 3-4h | 2026-02-12 | 2026-02-12 | 🟢 已完成 | 服务器成功启动！使用系统Python虚拟环境解决了GLIBCXX版本问题 |
| 1.3 理解进程架构 | 4-5h | 2026-02-12 | 2026-02-12 | 🟢 已完成 | 完成多进程架构分析，包含主进程、Scheduler Workers、Tokenizer Workers、Detokenizer Worker的分析 |
| 1.4 跟踪请求生命周期 | 5-6h | 2026-02-12 | 2026-02-12 | 🟢 已完成 | 完成请求生命周期分析，涵盖8个阶段和完整消息流 |
| 1.5 ZMQ通信分析 | 4-6h | 2026-02-12 | 2026-02-12 | 🟢 已完成 | 详细分析了ZMQ队列实现（同步/异步Push/Pull、Pub/Sub），深入研究了消息编码/解码机制（msgpack + 自定义类型序列化），理解了完整的进程间通信数据流，创建了ZMQ通信分析文档 |
| 1.6 配置参数实验 | 2-3h | 2026-02-12 | 2026-02-12 | 🟢 已完成 | 测试了不同配置参数（端口、并发数、内存比例等），分析了参数默认值和影响，创建了配置参数分析文档 |

**阶段一小结**：预计20-30小时，实际8小时，完成日期2026-02-12

## 阶段二：核心组件深入
| 任务 | 预计时长 | 实际开始 | 实际结束 | 状态 | 学习收获/笔记 |
|------|----------|----------|----------|------|---------------|
| 2.1 核心数据结构分析 | 6-8h | 2026-02-12 | 2026-02-20 | 🟢 已完成 | 深入分析SamplingParams/Req/Batch/Context四大核心结构，理解Req长度模型(cached_len/device_len/max_device_len)、eq=False设计意图、全局Context单例模式，笔记见 [2.1](./phase2/2.1-core-data-structures.md) |
| 2.2 调度器prefill阶段分析 | 5-6h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 分析PrefillManager/PrefillAdder/ChunkedReq，理解token budget限制、分块prefill机制、前缀缓存复用、空间预留策略，笔记见 [2.2](./phase2/2.2-prefill-scheduling.md) |
| 2.3 调度器decode阶段分析 | 5-6h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 分析DecodeManager极简设计、Prefill→Decode转换路径、Prefill优先调度策略、Overlap Scheduling双Stream设计，笔记见 [2.3](./phase2/2.3-decode-scheduling.md) |
| 2.4 引擎初始化分析 | 4-5h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 分析Engine初始化12步流程、Meta Device两步加载、KV cache页数动态计算、分布式通信初始化(Gloo+PyNCCL)，笔记见 [2.4](./phase2/2.4-engine-init.md) |
| 2.5 推理流程跟踪 | 5-6h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 跟踪完整推理路径：token_pool读写→forward_batch→CUDA图回放/正常forward→Sampler采样→异步GPU→CPU拷贝，笔记见 [2.5](./phase2/2.5-forward-pipeline.md) |
| 2.6 模型实现分析 | 5-6h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 分析模型注册机制、无参forward设计、Llama层级结构、Fused RMSNorm residual传递、TP并行层，笔记见 [2.6](./phase2/2.6-model-impl.md) |

**阶段二小结**：预计30-40小时，实际完成日期2026-02-20

## 阶段三：高级特性与优化
| 任务 | 预计时长 | 实际开始 | 实际结束 | 状态 | 学习收获/笔记 |
|------|----------|----------|----------|------|---------------|
| 3.1 注意力后端对比 | 6-8h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 分析FA/FI/Hybrid三种后端、auto选择策略(SM90=Hybrid,SM100=FI)、BaseAttnBackend接口和注册表模式，笔记见 [3.1](./phase3/3.1-attention-backends.md) |
| 3.2 FlashAttention实现分析 | 5-6h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 分析FAMetadata(cu_seqlens)、2D子页表构建、FA3调用(sgl_kernel)、CUDA图固定缓冲区copy策略，笔记见 [3.2](./phase3/3.2-flash-attention.md) |
| 3.3 FlashInfer实现分析 | 5-6h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 分析plan()+run()两阶段API、1D ragged indices、Tensor Core决策(GQA>=4)、workspace共享、CUDAGraphWrapper，笔记见 [3.3](./phase3/3.3-flash-infer.md) |
| 3.4 KV缓存管理分析 | 6-8h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 深入分析MHAKVCache显存布局、NaiveCache空壳实现、RadixCache的Radix Tree结构/前缀匹配/_walk/_split_at/LRU驱逐/引用计数锁定机制，笔记见 [3.4](./phase3/3.4-kv-cache.md) |
| 3.5 分布式通信分析 | 4-6h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 分析插件式DistributedCommunicator、PyNCCL初始化流程、TP通信拓扑(Embedding all_reduce/O-proj all_reduce/MLP all_reduce/LMHead all_gather)，笔记见 [3.5](./phase3/3.5-distributed.md) |
| 3.6 CUDA内核分析 | 4-6h | 2026-02-20 | 2026-02-20 | 🟢 已完成 | 分析TVM-FFI JIT/AOT双编译路径、indexing/store_cache内核、PyNCCL FFI绑定、Radix快速比较、Triton fused_moe_kernel完整流程，笔记见 [3.6](./phase3/3.6-cuda-kernels.md) |

**阶段三小结**：预计30-40小时，完成日期2026-02-20

## 阶段四：扩展与贡献
| 任务 | 预计时长 | 实际开始 | 实际结束 | 状态 | 学习收获/笔记 |
|------|----------|----------|----------|------|---------------|
| 4.1 工具类分析 | 4-5h | | | 🔴 未开始 | |
| 4.2 测试框架学习 | 5-6h | | | 🔴 未开始 | |
| 4.3 基准测试分析 | 5-6h | | | 🔴 未开始 | |
| 4.4 Python API分析 | 3-4h | | | 🔴 未开始 | |
| 4.5 功能扩展实践 | 6-8h | | | 🔴 未开始 | |

**阶段四小结**：预计20-30小时，实际______小时，完成日期______

## 总体总结
- 总预计时长：100-140小时
- 总实际时长：______小时
- 总体完成日期：______
- 关键收获：______
- 下一步计划：______

## 状态标记说明
- 🔴 **未开始**：任务尚未开始
- 🟡 **进行中**：任务正在进行中
- 🟢 **已完成**：任务已完成
- ⚫ **跳过**：任务被跳过（需说明原因）

## 学习检查点与评估

### 每周检查点（建议每周日进行）
1. **进度回顾**：检查本周完成的任务，更新跟踪表
2. **难点分析**：记录遇到的问题和解决方案
3. **收获总结**：总结本周学到的重要概念
4. **下周计划**：规划下周要完成的任务

### 阶段评估标准
**阶段一完成标准**：
- ✓ 能够成功运行mini-sGLang服务器
- ✓ 理解多进程架构的基本组成
- ✓ 能够跟踪一个请求的完整生命周期

**阶段二完成标准**：
- ✓ 理解Req、Batch、Context等核心数据结构
- ✓ 能够解释prefill和decode的区别
- ✓ 了解引擎初始化和推理的基本流程

**阶段三完成标准**：
- ✓ 理解不同注意力后端的差异
- ✓ 掌握KV缓存管理的基本原理
- ✓ 了解分布式通信和CUDA优化的概念

**阶段四完成标准**：
- ✓ 能够运行和编写测试
- ✓ 能够使用基准测试工具
- ✓ 能够进行简单的代码修改和扩展

### 学习资源管理
1. **笔记系统**：为每个任务创建学习笔记
2. **代码注释**：在阅读代码时添加自己的理解注释
3. **问题记录**：建立问题清单，记录待解决的问题
4. **参考链接**：收集相关论文、文档和资源链接

## 执行计划

### 文件创建
1. **创建task.md**：将"详细任务拆分"部分保存为`/home/kason/python_workspace/mini-sglang/plans/task.md`
2. **创建跟踪.md**：将"进度跟踪系统"部分保存为`/home/kason/python_workspace/mini-sglang/plans/跟踪.md`

### 启动学习
1. **初始化跟踪文件**：填写基本信息，设置开始日期
2. **按顺序执行任务**：从阶段一任务1.1开始
3. **定期更新进度**：每周更新跟踪文件，记录学习收获

### 灵活调整
- 根据实际学习进度调整任务顺序
- 遇到困难时可适当延长任务时间或寻求帮助
- 保持学习兴趣比严格按计划更重要